# Быстрая инструкция: Применение изменений для множественных организаций

## Что сделано

✅ Изменена модель Patient: теперь у пациента может быть несколько организаций  
✅ Создана миграция для БД  
✅ Обновлены все serializers и views  
✅ Обновлена логика добавления пациента по ИИН  

## Как применить

### 1. Применить миграцию БД

**Windows PowerShell:**
```powershell
cd "C:\Users\Kudarov Umar\Desktop\My Projects\Medicine\backend"
python manage.py migrate patients
```

**Docker:**
```bash
docker-compose exec backend python manage.py migrate patients
```

### 2. Перезапустить сервер

**Windows:**
```powershell
# Остановить текущий сервер (Ctrl+C)
# Затем запустить снова:
.\start_project.ps1
```

**Docker:**
```bash
docker-compose restart backend
```

## Что теперь работает

### До изменений:
- Пациент мог быть только в одной организации
- При добавлении в другую организацию создавалась копия
- Дублирование данных в БД

### После изменений:
- Пациент может быть в нескольких организациях
- При добавлении по ИИН просто добавляется организация
- Нет дублирования, одна запись на пациента

## Как использовать

### Добавить существующего пациента в свою организацию:

1. **API:** Отправить запрос с ИИН
```http
POST /api/v1/patients/send-verification/
{
  "iin": "123456789012"
}
```

2. **Получить тестовый код:** В ответе будет `"test_code": "1234"`

3. **Подтвердить код:**
```http
POST /api/v1/patients/verify-code/
{
  "verification_id": <ID из предыдущего ответа>,
  "code": "1234"
}
```

4. **Готово!** Пациент добавлен в вашу организацию

## Проверка

После применения проверьте:
- [ ] Миграция применена без ошибок
- [ ] Сервер запускается
- [ ] Можно просматривать список пациентов
- [ ] Можно создать нового пациента
- [ ] Можно добавить существующего пациента по ИИН

## Откат (если нужно)

```bash
python manage.py migrate patients 0008_patientverification
```

## Помощь

Если возникли проблемы, проверьте:
1. Бэкап БД создан перед миграцией
2. Все зависимости установлены
3. Нет запущенных процессов, использующих БД
4. Логи сервера на наличие ошибок

---

**Файл с полным описанием:** MULTI_ORGANIZATION_PATIENT_GUIDE.md

