# Исправление подсчета количества записей сотрудников

## Дата: 2025-11-05

## Проблема

В расписании у сотрудника "Қасымов Данияр" отображалось количество записей "2", но в сетке расписания не было видно ни одной записи. Это происходило из-за того, что:

1. **Отсутствие отображения количества записей** - в коде вообще не было реализовано отображение количества записей для каждого сотрудника
2. **Несоответствие с фильтрами** - если бы количество рассчитывалось на сервере, оно могло бы не учитывать фильтры по статусам, применяемые на клиенте

## Решение

### 1. Добавлено отображение количества записей

**Файл:** `frontend/src/pages/SchedulePage.vue`

**Изменения в шаблоне (строки 76-79):**
```vue
<div class="employee-info">
  <div class="employee-name">{{ employee.last_name }} {{ employee.first_name }}</div>
  <div class="employee-count">{{ getEmployeeAppointmentCount(employee.id) }}</div>
</div>
```

Вместо `employee.position` теперь отображается количество записей, рассчитанное функцией `getEmployeeAppointmentCount()`.

### 2. Добавлена функция подсчета записей

**Новая функция (строки 335-338):**
```javascript
function getEmployeeAppointmentCount(employeeId) {
  // Returns the count of appointments that match current filters
  return getEmployeeAppointments(employeeId).length
}
```

Эта функция:
- Использует существующую функцию `getEmployeeAppointments()` для получения отфильтрованного списка записей
- **Учитывает фильтр по статусам** - показывает только то количество, которое реально видно в сетке
- Возвращает точное количество видимых записей

### 3. Добавлены стили для счетчика

**Новые стили (строки 892-898):**
```scss
.employee-count {
  font-size: 16px;
  font-weight: 700;
  color: $text-primary;
  text-align: center;
  margin-top: 4px;
}
```

## Результат

Теперь количество записей:
- ✅ **Точное** - показывает реальное количество видимых записей в сетке
- ✅ **Синхронизировано с фильтрами** - если применен фильтр по статусам, счетчик показывает только отфильтрованные записи
- ✅ **Наглядное** - отображается крупным шрифтом под именем сотрудника

### Пример работы

1. **Без фильтров:** 
   - У Қасымов Данияр есть 2 записи → показывает "2"
   - В сетке видны обе записи

2. **С фильтром (например, только "Подтверждено"):**
   - У Қасымов Данияр есть 2 записи, но обе имеют статус "Отменено" → показывает "0"
   - В сетке нет записей

3. **Частичное совпадение:**
   - У Қасымов Данияр есть 3 записи: 2 подтверждены, 1 отменена
   - Фильтр: только "Подтверждено" → показывает "2"
   - В сетке видны 2 подтверждённые записи

## Техническая информация

- **Компонент:** `frontend/src/pages/SchedulePage.vue`
- **Функция фильтрации:** `getEmployeeAppointments(employeeId)` - используется повторно для подсчета
- **Реактивность:** Счетчик автоматически обновляется при:
  - Изменении списка записей (`appointments`)
  - Изменении фильтра по статусам (`statusFilter`)
  - Изменении выбранной даты (`selectedDate`)

## Проверка

Для проверки исправления:
1. Откройте страницу расписания
2. Посмотрите на количество записей под именем каждого сотрудника
3. Примените фильтр по статусам
4. Убедитесь, что количество соответствует видимым записям в сетке
5. Попробуйте разные комбинации фильтров

## Дополнительные замечания

- Если в будущем потребуется показывать **общее количество** записей (без учета фильтров), можно добавить отдельную функцию:
  ```javascript
  function getTotalEmployeeAppointmentCount(employeeId) {
    return appointments.value.filter((apt) => apt.employee === employeeId).length
  }
  ```
- Можно также добавить tooltip, показывающий "X из Y записей" (отфильтровано из общего числа)

