# Исправления: Ошибка загрузки филиалов и складов
**Дата:** 5 ноября 2025  
**Коммит:** 59e594b

## Проблема
При попытке загрузки филиалов и складов в компонентах фронтенда возникала ошибка. Данные не отображались в селекторах (dropdown меню).

## Причина
API Django REST Framework возвращает пагинированные ответы в формате:
```json
{
  "count": 123,
  "next": "...",
  "previous": "...",
  "results": [...]
}
```

Однако код фронтенда ожидал прямой массив и пытался вызвать `.map()` на объекте, что приводило к ошибке.

## Исправления

### 1. WarehouseModal.vue
**Функция:** `loadBranches()`
- Добавлена обработка пагинированных ответов
- Добавлено логирование ошибок для отладки

### 2. WarehouseMoveModal.vue
**Функции:**
- `loadBranches()` - исправлена обработка филиалов
- `loadStockItems()` - исправлена обработка номенклатуры
- `loadBatches()` - исправлена обработка партий

### 3. WarehouseBatchModal.vue
**Функции:**
- `loadWarehouses()` - исправлена обработка складов
- `loadStockItems()` - исправлена обработка номенклатуры

### 4. BillingPage.vue
**Функция:** `loadBranches()`
- Исправлена обработка филиалов (было исправлено ранее)

## Решение
Добавлена универсальная обработка ответа API, которая поддерживает оба формата:
```javascript
const branches = Array.isArray(response.data) 
  ? response.data 
  : (response.data.results || [])
```

Этот код:
1. Проверяет, является ли `response.data` массивом
2. Если да - использует его напрямую
3. Если нет - извлекает массив из `response.data.results`
4. Если и там ничего нет - возвращает пустой массив

## Результат
✅ Филиалы теперь корректно загружаются во всех компонентах  
✅ Склады корректно отображаются в селекторах  
✅ Номенклатура и партии загружаются без ошибок  
✅ Добавлено логирование для упрощения отладки в будущем  

## Тестирование
После применения исправлений проверьте:
1. Открытие модального окна создания склада - филиалы должны загружаться
2. Создание движения товара - филиалы и номенклатура должны загружаться
3. Создание партии - склады и номенклатура должны загружаться
4. Страница финансов - филиалы должны загружаться для кассовых смен

## Изменённые файлы
- `frontend/src/components/WarehouseModal.vue`
- `frontend/src/components/WarehouseMoveModal.vue`
- `frontend/src/components/WarehouseBatchModal.vue`
- `frontend/src/pages/BillingPage.vue` (ранее)

## Дополнительная информация
Проблема была вызвана тем, что `BranchViewSet` в Django использует `PageNumberPagination`, которая оборачивает результаты в объект с ключом `results`. Все исправления теперь учитывают этот формат.




