# Multi-Organization Patient Consent System

## –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã

–ü–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –º–Ω–æ–≥–æ–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–º –∫–∞—Ä—Ç–∞–º –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤ —Å –ø–∞—Ü–∏–µ–Ω—Ç-—Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–º —Å–æ–≥–ª–∞—Å–∏–µ–º —á–µ—Ä–µ–∑ Telegram OTP.

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### Backend (Django)
- ‚úÖ **Patient Model** - –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –ò–ò–ù (AES-256), —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –ø–æ–∏—Å–∫–∞
- ‚úÖ **Consent App** - –ú–æ–¥–µ–ª–∏ AccessRequest, ConsentToken, AccessGrant, AuditLog
- ‚úÖ **EHR App** - Unified Electronic Health Records —Å –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- ‚úÖ **API Endpoints** - –ü–æ–ª–Ω—ã–π REST API –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- ‚úÖ **Middleware** - ConsentCheckMiddleware –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–∞
- ‚úÖ **Rate Limiting** - Redis-based –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ **Anti-Fraud** - –î–µ—Ç–µ–∫—Ç–æ—Ä –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- ‚úÖ **Audit Logging** - –ò–º–º—É—Ç–∞–±–µ–ª—å–Ω—ã–µ –ª–æ–≥–∏ –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π
- ‚úÖ **Whitelist** - –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ –¥–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –¥–æ—Å—Ç—É–ø—ã

### Telegram Bot
- ‚úÖ **OTP Flow** - –ü–æ–ª—É—á–µ–Ω–∏–µ –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ —á–µ—Ä–µ–∑ –±–æ—Ç–∞
- ‚úÖ **Personal Cabinet** - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞–º–∏ (/my_access)
- ‚úÖ **Grant Management** - –ü—Ä–æ—Å–º–æ—Ç—Ä, –æ—Ç–∑—ã–≤ –¥–æ—Å—Ç—É–ø–æ–≤
- ‚úÖ **Notifications** - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∑–∞–ø—Ä–æ—Å–∞—Ö –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö

### Frontend (Vue.js)
- ‚úÖ **AccessRequestModal** - –ó–∞–ø—Ä–æ—Å –¥–æ—Å—Ç—É–ø–∞ –ø–æ –ò–ò–ù —Å real-time —Å—Ç–∞—Ç—É—Å–æ–º
- ‚úÖ **ExternalRecordsSection** - –ü—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–ø–∏—Å–µ–π –¥—Ä—É–≥–∏—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π
- ‚úÖ **EHR API Client** - –ü–æ–ª–Ω—ã–π –∫–ª–∏–µ–Ω—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∑–∞–ø–∏—Å—è–º–∏

### Security
- ‚úÖ **RBAC** - –†–æ–ª–∏ –∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è
- ‚úÖ **Rate Limiting** - 3 –∑–∞–ø—Ä–æ—Å–∞/–¥–µ–Ω—å –Ω–∞ –ø–∞—Ü–∏–µ–Ω—Ç–∞
- ‚úÖ **Fraud Detection** - –ê–Ω–∞–ª–∏–∑ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- ‚úÖ **Encryption** - AES-256 –¥–ª—è –ò–ò–ù, SHA-256 –¥–ª—è –ø–æ–∏—Å–∫–∞
- ‚úÖ **Audit Trail** - –ü–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –¥–æ—Å—Ç—É–ø–∞

### Testing
- ‚úÖ **Unit Tests** - –¢–µ—Å—Ç—ã –º–æ–¥–µ–ª–µ–π –∏ –ª–æ–≥–∏–∫–∏
- ‚úÖ **Integration Tests** - –¢–µ—Å—Ç—ã –ø–æ–ª–Ω–æ–≥–æ consent flow
- ‚úÖ **API Tests** - –¢–µ—Å—Ç—ã endpoints

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. Environment Variables

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –ø–∞–ø–∫–µ `backend/`:

```bash
# Django
DEBUG=True
SECRET_KEY=your-secret-key-here

# Database
DATABASE_URL=postgresql://user:password@localhost:5432/medicine_db

# Redis
REDIS_URL=redis://localhost:6379/0

# IIN Encryption
IIN_ENCRYPTION_KEY=your-fernet-key-here  # Generate with: from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())
IIN_HASH_SALT=your-random-salt-here

# Telegram Bot
TELEGRAM_BOT_TOKEN=your-bot-token
TELEGRAM_BOT_API_SECRET=your-api-secret

# Consent Settings
ENABLE_MULTI_ORG_CONSENT=true
CONSENT_OTP_TTL_MINUTES=10
CONSENT_GRANT_DEFAULT_DAYS=30
CONSENT_RATE_LIMIT_PER_DAY=3
```

### 2. Database Migrations

```bash
cd backend
python manage.py migrate
```

### 3. Encrypt Existing IINs

–ï—Å–ª–∏ —É –≤–∞—Å —É–∂–µ –µ—Å—Ç—å –ø–∞—Ü–∏–µ–Ω—Ç—ã —Å –Ω–µ–∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –ò–ò–ù:

```bash
# Dry run (preview)
python manage.py encrypt_existing_iins --dry-run

# Actual encryption
python manage.py encrypt_existing_iins
```

### 4. Start Services

```bash
# Backend (Terminal 1)
cd backend
python manage.py runserver

# Celery Worker (Terminal 2)
cd backend
celery -A config worker -l info

# Telegram Bot (Terminal 3)
cd telegram_bot
python main.py

# Frontend (Terminal 4)
cd frontend
npm run dev
```

## üìñ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –í—Ä–∞—á –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –¥–æ—Å—Ç—É–ø

1. –í SchedulePage –Ω–∞–∂–∞—Ç—å **"üîê –ó–∞–ø—Ä–æ—Å –¥–æ—Å—Ç—É–ø–∞"**
2. –í–≤–µ—Å—Ç–∏ –ò–ò–ù –ø–∞—Ü–∏–µ–Ω—Ç–∞ (12 —Ü–∏—Ñ—Ä)
3. –í—ã–±—Ä–∞—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ (scopes)
4. –£–∫–∞–∑–∞—Ç—å –ø—Ä–∏—á–∏–Ω—É –∑–∞–ø—Ä–æ—Å–∞
5. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å

### –ü–∞—Ü–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç OTP –≤ Telegram

–ü–∞—Ü–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ:
```
üè• –ó–∞–ø—Ä–æ—Å –¥–æ—Å—Ç—É–ø–∞ –∫ –≤–∞—à–µ–π –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–π –∫–∞—Ä—Ç–µ

–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è: –ö–ª–∏–Ω–∏–∫–∞ XYZ
–ü—Ä–∏—á–∏–Ω–∞: –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è —Ç–µ—Ä–∞–ø–µ–≤—Ç–∞

–ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã–π –¥–æ—Å—Ç—É–ø:
‚Ä¢ –ß—Ç–µ–Ω–∏–µ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏—Ö –∑–∞–ø–∏—Å–µ–π
‚Ä¢ –ü—Ä–æ—Å–º–æ—Ç—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

–ö–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è: 123456

[‚úÖ –†–∞–∑—Ä–µ—à–∏—Ç—å] [‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å] [‚ÑπÔ∏è –ü–æ–¥—Ä–æ–±–Ω–µ–µ]
```

### –ü–∞—Ü–∏–µ–Ω—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç/–æ—Ç–∫–ª–æ–Ω—è–µ—Ç

- **–†–∞–∑—Ä–µ—à–∏—Ç—å** ‚Üí AccessGrant —Å–æ–∑–¥–∞—ë—Ç—Å—è, –≤—Ä–∞—á –ø–æ–ª—É—á–∞–µ—Ç –¥–æ—Å—Ç—É–ø
- **–û—Ç–∫–ª–æ–Ω–∏—Ç—å** ‚Üí –ó–∞–ø—Ä–æ—Å –æ—Ç–∫–ª–æ–Ω—è–µ—Ç—Å—è, –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –Ω–∞ 1 —á–∞—Å
- **–ü–æ–¥—Ä–æ–±–Ω–µ–µ** ‚Üí –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–ø—Ä–æ—Å–µ

### –í—Ä–∞—á –ø–æ–ª—É—á–∞–µ—Ç –¥–æ—Å—Ç—É–ø

–ü–æ—Å–ª–µ –æ–¥–æ–±—Ä–µ–Ω–∏—è:
- –ü–æ—è–≤–ª—è–µ—Ç—Å—è —Å–µ–∫—Ü–∏—è **"–ó–∞–ø–∏—Å–∏ –∏–∑ –¥—Ä—É–≥–∏—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π"**
- –í—Å–µ –∑–∞–ø–∏—Å–∏ –ø–æ–º–µ—á–µ–Ω—ã watermark'–æ–º –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
- –î–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –Ω–∞ —á—Ç–µ–Ω–∏–µ (–µ—Å–ª–∏ –Ω–µ –≤—ã–¥–∞–Ω write_records)

## üîê Security Features

### Rate Limiting
- **3 –∑–∞–ø—Ä–æ—Å–∞ –≤ –¥–µ–Ω—å** –Ω–∞ –æ–¥–Ω–æ–≥–æ –ø–∞—Ü–∏–µ–Ω—Ç–∞ –æ—Ç –æ–¥–Ω–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
- **3 –æ—Ç–∫–∞–∑–∞ –ø–æ–¥—Ä—è–¥** ‚Üí –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –Ω–∞ 1 —á–∞—Å

### Anti-Fraud Detection
- –ú–∞—Å—Å–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã (>10 –∑–∞ —á–∞—Å) ‚Üí –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞
- –ù–æ—á–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã (00:00-06:00) ‚Üí –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
- –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∑–∞ –∫–æ—Ä–æ—Ç–∫–∏–π –ø–µ—Ä–∏–æ–¥ ‚Üí –ª–æ–≥
- –í—ã—Å–æ–∫–∞—è —á–∞—Å—Ç–æ—Ç–∞ –¥–æ—Å—Ç—É–ø–∞ (>50/—á–∞—Å) ‚Üí –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞

### Audit Logging
- **–í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è** –ª–æ–≥–∏—Ä—É—é—Ç—Å—è (read, write, share, revoke)
- –õ–æ–≥–∏ **–∏–º–º—É—Ç–∞–±–µ–ª—å–Ω—ã–µ** (–Ω–µ–ª—å–∑—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å/—É–¥–∞–ª–∏—Ç—å)
- –•—Ä–∞–Ω–∏—Ç—Å—è IP, user agent, timestamp
- –ü–∞—Ü–∏–µ–Ω—Ç –º–æ–∂–µ—Ç –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å —á–µ—Ä–µ–∑ /my_access

## üìä API Endpoints

### Consent System

```
POST   /api/v1/consent/search-patient/              # –ü–æ–∏—Å–∫ –ø–∞—Ü–∏–µ–Ω—Ç–∞ –ø–æ –ò–ò–ù
POST   /api/v1/consent/access-requests/             # –°–æ–∑–¥–∞—Ç—å –∑–∞–ø—Ä–æ—Å –¥–æ—Å—Ç—É–ø–∞
GET    /api/v1/consent/access-requests/{id}/        # –ü–æ–ª—É—á–∏—Ç—å –∑–∞–ø—Ä–æ—Å
GET    /api/v1/consent/access-requests/{id}/status/ # –°—Ç–∞—Ç—É—Å –∑–∞–ø—Ä–æ—Å–∞ (polling)
POST   /api/v1/consent/otp/verify/                  # –í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å OTP
GET    /api/v1/consent/grants/                      # –°–ø–∏—Å–æ–∫ –≥—Ä–∞–Ω—Ç–æ–≤
POST   /api/v1/consent/grants/{id}/revoke/          # –û—Ç–æ–∑–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø
POST   /api/v1/consent/grants/create_whitelist/     # –°–æ–∑–¥–∞—Ç—å whitelist
GET    /api/v1/consent/grants/my_grants/            # –ú–æ–∏ –≥—Ä–∞–Ω—Ç—ã (–¥–ª—è –ø–∞—Ü–∏–µ–Ω—Ç–∞)
GET    /api/v1/consent/audit-logs/                  # Audit –ª–æ–≥–∏
```

### EHR System

```
GET    /api/v1/ehr/records/                         # –°–ø–∏—Å–æ–∫ –∑–∞–ø–∏—Å–µ–π
GET    /api/v1/ehr/records/?include_external=true   # + –≤–Ω–µ—à–Ω–∏–µ –∑–∞–ø–∏—Å–∏
GET    /api/v1/ehr/records/patient_summary/         # –°–≤–æ–¥–∫–∞ –ø–æ –ø–∞—Ü–∏–µ–Ω—Ç—É
GET    /api/v1/ehr/records/{id}/                    # –ü–æ–ª—É—á–∏—Ç—å –∑–∞–ø–∏—Å—å
POST   /api/v1/ehr/records/                         # –°–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å—å
PUT    /api/v1/ehr/records/{id}/                    # –û–±–Ω–æ–≤–∏—Ç—å (—Å–æ–∑–¥–∞—ë—Ç –≤–µ—Ä—Å–∏—é)
DELETE /api/v1/ehr/records/{id}/                    # –£–¥–∞–ª–∏—Ç—å (soft delete)
```

## üì± Telegram Bot Commands

```
/start         - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è/–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
/my_access     - –ú–æ–∏ –¥–æ—Å—Ç—É–ø—ã –∫ –º–µ–¥–∫–∞—Ä—Ç–µ
/my_appointments - –ú–æ–∏ –∑–∞–ø–∏—Å–∏ –∫ –≤—Ä–∞—á–∞–º
```

## üß™ Running Tests

```bash
cd backend

# All tests
python manage.py test

# Consent tests only
python manage.py test apps.consent.tests

# EHR tests only
python manage.py test apps.ehr.tests

# Specific test
python manage.py test apps.consent.tests.test_consent_flow.ConsentFlowTestCase.test_access_request_creation
```

## üìù –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö

### AccessRequest
- patient, requester_org, requester_user
- scopes[], reason, requested_duration_days
- status (pending/approved/denied/expired)
- expires_at (TTL 10 –º–∏–Ω—É—Ç)

### ConsentToken
- access_request, otp_code_hash
- attempts_count, max_attempts
- expires_at, used_at

### AccessGrant
- patient, grantee_org
- scopes[], valid_from, valid_to
- is_whitelist, created_by
- revoked_at, last_accessed_at, access_count

### AuditLog
- user, organization, patient
- action, object_type, object_id
- ip_address, user_agent, details
- **–ò–º–º—É—Ç–∞–±–µ–ª—å–Ω—ã–π**

### EHRRecord
- patient, organization, author
- record_type, title, payload
- version, previous_version
- is_external, is_deleted

## üéØ –°—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –≠–∫—Å—Ç—Ä–µ–Ω–Ω—ã–π —Å–ª—É—á–∞–π
1. –í—Ä–∞—á –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –¥–æ—Å—Ç—É–ø —Å –ø—Ä–∏—á–∏–Ω–æ–π "–≠–∫—Å—Ç—Ä–µ–Ω–Ω–∞—è –ø–æ–º–æ—â—å"
2. –ü–∞—Ü–∏–µ–Ω—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –≤ Telegram (–¥–∞–∂–µ –Ω–æ—á—å—é)
3. –î–æ—Å—Ç—É–ø –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ 1-7 –¥–Ω–µ–π
4. –í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è

### –ü–ª–∞–Ω–æ–≤–∞—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è
1. –ü–∞—Ü–∏–µ–Ω—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç –≤ –Ω–æ–≤—É—é –∫–ª–∏–Ω–∏–∫—É
2. –í—Ä–∞—á –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –∏—Å—Ç–æ—Ä–∏–∏
3. –ü–∞—Ü–∏–µ–Ω—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç —Å —Ç–µ–ª–µ—Ñ–æ–Ω–∞
4. –í—Ä–∞—á –≤–∏–¥–∏—Ç –≤—Å–µ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –∑–∞–ø–∏—Å–∏
5. –ú–æ–∂–µ—Ç –≤–Ω–æ—Å–∏—Ç—å –Ω–æ–≤—ã–µ –∑–∞–ø–∏—Å–∏ (–µ—Å–ª–∏ scope —Ä–∞–∑—Ä–µ—à—ë–Ω)

### –°–µ–º–µ–π–Ω—ã–π –≤—Ä–∞—á (Whitelist)
1. –ü–∞—Ü–∏–µ–Ω—Ç –≤ Telegram: "–í—Å–µ–≥–¥–∞ –¥–æ–≤–µ—Ä—è—Ç—å —ç—Ç–æ–π –∫–ª–∏–Ω–∏–∫–µ"
2. –°–æ–∑–¥–∞—ë—Ç—Å—è whitelist grant –Ω–∞ 6-12 –º–µ—Å—è—Ü–µ–≤
3. –í—Ä–∞—á –ø–æ–ª—É—á–∞–µ—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø –±–µ–∑ OTP
4. –ü–∞—Ü–∏–µ–Ω—Ç –º–æ–∂–µ—Ç –æ—Ç–æ–∑–≤–∞—Ç—å –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç

## üîÑ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Frontend  ‚îÇ ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ ‚îÇ   Backend    ‚îÇ ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ ‚îÇ  Telegram   ‚îÇ
‚îÇ   (Vue.js)  ‚îÇ   API   ‚îÇ   (Django)   ‚îÇ   API   ‚îÇ     Bot     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                               ‚îÇ                         ‚îÇ
                               ‚ñº                         ‚ñº
                        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                        ‚îÇ  PostgreSQL  ‚îÇ         ‚îÇ   Patient   ‚îÇ
                        ‚îÇ   + Redis    ‚îÇ         ‚îÇ  (Telegram) ‚îÇ
                        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–í—Å–µ —Å–æ–±—ã—Ç–∏—è –¥–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ AuditLog:
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è–º
- –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
- –ü—Ä–æ—Ü–µ–Ω—Ç –æ–¥–æ–±—Ä–µ–Ω–∏–π/–æ—Ç–∫–∞–∑–æ–≤
- –ß–∞—Å—Ç–æ—Ç–∞ –æ—Ç–∑—ã–≤–æ–≤ –¥–æ—Å—Ç—É–ø–∞
- –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å

## üö® Troubleshooting

### OTP –Ω–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç –≤ Telegram
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å TELEGRAM_BOT_TOKEN
- –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ Celery worker –∑–∞–ø—É—â–µ–Ω
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –ø–∞—Ü–∏–µ–Ω—Ç –ø—Ä–∏–≤—è–∑–∞–ª Telegram

### –û—à–∏–±–∫–∞ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –ò–ò–ù
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `cryptography`: `pip install cryptography`
- –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–ª—é—á: `from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())`
- –î–æ–±–∞–≤–∏—Ç—å –≤ .env: `IIN_ENCRYPTION_KEY=...`

### Rate limit –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ Redis –∑–∞–ø—É—â–µ–Ω
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å REDIS_URL –≤ .env
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ ConsentRateLimiter –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ

- –í—Å–µ –ò–ò–ù —à–∏—Ñ—Ä—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏
- –ü–∞—Ü–∏–µ–Ω—Ç—ã –≥–ª–æ–±–∞–ª—å–Ω—ã–µ (–±–µ–∑ –ø—Ä–∏–≤—è–∑–∫–∏ –∫ organization)
- –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ EHR –∑–∞–ø–∏—Å–µ–π immutable (–Ω–µ–ª—å–∑—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å, —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ –≤–µ—Ä—Å–∏–∏)
- Audit logs –Ω–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å
- Rate limiting –∏ anti-fraud –≤—Å—Ç—Ä–æ–µ–Ω—ã –≤ serializers

## üéâ –ì–æ—Ç–æ–≤–æ –∫ production!

–°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é.
–í—Å–µ 4 —Å–ø—Ä–∏–Ω—Ç–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –Ω–∞ –º–µ—Å—Ç–µ, —Ç–µ—Å—Ç—ã –Ω–∞–ø–∏—Å–∞–Ω—ã.

