# –ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∞—è –¥–∏–∫—Ç–æ–≤–∫–∞ - Desktop App

–î–µ—Å–∫—Ç–æ–ø-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –≤—Ä–∞—á–µ–π —Å —Ñ—É–Ω–∫—Ü–∏–µ–π –¥–∏–∫—Ç–æ–≤–∫–∏ –∏ OTP-–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π –¥–æ—Å—Ç—É–ø–∞ –∫ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–º –∫–∞—Ä—Ç–∞–º –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤.

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- üîê **OTP-–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ –ò–ò–ù**: –í—Ä–∞—á –≤–≤–æ–¥–∏—Ç –ò–ò–ù –ø–∞—Ü–∏–µ–Ω—Ç–∞, –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω –ø–∞—Ü–∏–µ–Ω—Ç–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è OTP-–∫–æ–¥ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞
- üé§ **–ì–æ–ª–æ—Å–æ–≤–∞—è –¥–∏–∫—Ç–æ–≤–∫–∞**: Real-time —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–µ—á–∏ (Vosk STT)
- üìù **–ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö**: –ü–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è OTP –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ –ø–∞—Ü–∏–µ–Ω—Ç–∞
- üíæ **Offline —Ä–µ–∂–∏–º**: –ß–µ—Ä–Ω–æ–≤–∏–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- üîí **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ —Å–∏—Å—Ç–µ–º—É grants —Å audit logging

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### Backend API Endpoints

- `POST /api/v1/auth/login/` - –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤—Ä–∞—á–∞
- `POST /api/v1/consent/search-patient/` - –ü–æ–∏—Å–∫ –ø–∞—Ü–∏–µ–Ω—Ç–∞ –ø–æ –ò–ò–ù
- `POST /api/v1/consent/access-requests/` - –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ –¥–æ—Å—Ç—É–ø–∞
- `GET /api/v1/consent/access-requests/{id}/status/` - Polling —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–ø—Ä–æ—Å–∞
- `GET /api/v1/patients/by-grant/{grant_id}/` - –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–∞—Ü–∏–µ–Ω—Ç–∞ –ø–æ grant
- `POST /api/v1/visits/notes/` - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∏–∫—Ç–æ–≤–∫–∏

### Frontend Flow

```
Login ‚Üí PatientAccess (–ò–ò–ù ‚Üí OTP) ‚Üí Dictation ‚Üí Review ‚Üí Submit
```

### State Machine

- `idle` - –û–∂–∏–¥–∞–Ω–∏–µ –Ω–∞—á–∞–ª–∞ –ø—Ä–∏—ë–º–∞
- `access_pending` - –û–∂–∏–¥–∞–Ω–∏–µ OTP –æ—Ç –ø–∞—Ü–∏–µ–Ω—Ç–∞  
- `access_granted` - –î–æ—Å—Ç—É–ø –≤—ã–¥–∞–Ω, –≥–æ—Ç–æ–≤ –∫ –¥–∏–∫—Ç–æ–≤–∫–µ
- `dictating` - –ò–¥—ë—Ç –∑–∞–ø–∏—Å—å
- `paused` - –ó–∞–ø–∏—Å—å –Ω–∞ –ø–∞—É–∑–µ
- `review` - –ü—Ä–æ—Å–º–æ—Ç—Ä –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- `sending` - –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
- `completed` - –£—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ
- `error` - –û—à–∏–±–∫–∞

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Node.js 18+
- Python 3.9+ (–¥–ª—è backend)
- PostgreSQL 13+
- Redis 6+

### Backend setup

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
cd backend
pip install -r requirements.txt

# –ú–∏–≥—Ä–∞—Ü–∏–∏
python manage.py migrate

# –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
python manage.py runserver

# –ó–∞–ø—É—Å–∫ Celery (–≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ)
celery -A config worker -l info

# –ó–∞–ø—É—Å–∫ Telegram –±–æ—Ç–∞ (–≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ)
cd telegram_bot
python main.py
```

### Desktop setup

```bash
cd desktop

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
npm install

# –ó–∞–ø—É—Å–∫ –≤ dev —Ä–µ–∂–∏–º–µ
npm run dev

# –°–±–æ—Ä–∫–∞ –¥–ª—è production
npm run build
npm run build:electron
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–°–æ–∑–¥–∞–π—Ç–µ `.env` —Ñ–∞–π–ª –≤ –ø–∞–ø–∫–µ `desktop`:

```env
VITE_API_URL=http://localhost:8000/api/v1
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### 1. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

–í–æ–π–¥–∏—Ç–µ —Å —É—á—ë—Ç–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –≤—Ä–∞—á–∞ (username/password).

### 2. –ó–∞–ø—Ä–æ—Å –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞—Ä—Ç–µ –ø–∞—Ü–∏–µ–Ω—Ç–∞

1. –í–≤–µ–¥–∏—Ç–µ –ò–ò–ù –ø–∞—Ü–∏–µ–Ω—Ç–∞ (12 —Ü–∏—Ñ—Ä)
2. –£–∫–∞–∂–∏—Ç–µ –ø—Ä–∏—á–∏–Ω—É –∑–∞–ø—Ä–æ—Å–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–ü—Ä–∏—ë–º —É –≤—Ä–∞—á–∞")
3. –í—ã–±–µ—Ä–∏—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞:
   - –ß—Ç–µ–Ω–∏–µ –∫—Ä–∞—Ç–∫–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
   - –ß—Ç–µ–Ω–∏–µ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏—Ö –∑–∞–ø–∏—Å–µ–π
   - –°–æ–∑–¥–∞–Ω–∏–µ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏—Ö –∑–∞–ø–∏—Å–µ–π

4. –ù–∞–∂–º–∏—Ç–µ "–ó–∞–ø—Ä–æ—Å–∏—Ç—å –¥–æ—Å—Ç—É–ø"

### 3. –û–∂–∏–¥–∞–Ω–∏–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è

–ù–∞ —Ç–µ–ª–µ—Ñ–æ–Ω –ø–∞—Ü–∏–µ–Ω—Ç–∞ (—á–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞) –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∑–∞–ø—Ä–æ—Å —Å OTP-–∫–æ–¥–æ–º. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –∫–∞–∂–¥—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã.

–í–æ–∑–º–æ–∂–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:
- ‚úÖ **Approved** - –¥–æ—Å—Ç—É–ø –≤—ã–¥–∞–Ω, –ø–µ—Ä–µ—Ö–æ–¥ –∫ –¥–∏–∫—Ç–æ–≤–∫–µ
- ‚ùå **Denied** - –ø–∞—Ü–∏–µ–Ω—Ç –æ—Ç–∫–ª–æ–Ω–∏–ª –∑–∞–ø—Ä–æ—Å
- ‚è±Ô∏è **Expired** - –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –∏—Å—Ç–µ–∫–ª–æ (10 –º–∏–Ω—É—Ç)

### 4. –î–∏–∫—Ç–æ–≤–∫–∞

–ü–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è:

1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ –ø–∞—Ü–∏–µ–Ω—Ç–∞ (–§–ò–û, –≤–æ–∑—Ä–∞—Å—Ç, –ò–ò–ù)
2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –Ω–∞–ª–∏—á–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –≤–∏–∑–∏—Ç–∞ –∏–ª–∏ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç—Å—è —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π
3. –î–æ—Å—Ç—É–ø–Ω—ã controls:
   - **‚óè –ù–∞—á–∞—Ç—å –∑–∞–ø–∏—Å—å** - —Å—Ç–∞—Ä—Ç –¥–∏–∫—Ç–æ–≤–∫–∏
   - **‚Äñ –ü–∞—É–∑–∞** - –≤—Ä–µ–º–µ–Ω–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞
   - **‚ñ∂ –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å** - –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
   - **‚ñ† –ó–∞–≤–µ—Ä—à–∏—Ç—å** - –ø–µ—Ä–µ—Ö–æ–¥ –∫ –ø—Ä–æ—Å–º–æ—Ç—Ä—É

–¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ real-time –∏ –º–æ–∂–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è –≤—Ä—É—á–Ω—É—é.

### 5. –ü—Ä–æ—Å–º–æ—Ç—Ä –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞

1. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
2. –í—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫ –¥–∏–∫—Ç–æ–≤–∫–∏ (RU/KK)
3. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):
   - –î–∏–∞–≥–Ω–æ–∑
   - –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
4. –ù–∞–∂–º–∏—Ç–µ "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ ERP"

–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ Visit –∏ —Å–æ–∑–¥–∞—ë—Ç—Å—è EHR Record —Å audit logging.

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –í—Å–µ –ò–ò–ù —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–º –≤–∏–¥–µ (AES-256 Fernet)
- –ü–æ–∏—Å–∫ –ø–æ –ò–ò–ù –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ SHA-256 hash
- –î–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º –ø–∞—Ü–∏–µ–Ω—Ç–∞ —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –∞–∫—Ç–∏–≤–Ω—ã–π grant
- –í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ audit trail
- Grants –∏–º–µ—é—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 2 —á–∞—Å–∞ –¥–ª—è –¥–µ—Å–∫—Ç–æ–ø–∞)
- Rate limiting: –Ω–µ –±–æ–ª–µ–µ 3 –∑–∞–ø—Ä–æ—Å–æ–≤/–¥–µ–Ω—å –Ω–∞ –æ–¥–Ω–æ–≥–æ –ø–∞—Ü–∏–µ–Ω—Ç–∞

## Offline —Ä–µ–∂–∏–º

(–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)

–ü—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è:
- –î–∏–∫—Ç–æ–≤–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ª–æ–∫–∞–ª—å–Ω—ã–π SQLite outbox
- –ü—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è
- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å—Ç–∞—Ç—É—Å–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –≤ UI

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
desktop/
‚îú‚îÄ‚îÄ electron/          # Main process
‚îÇ   ‚îú‚îÄ‚îÄ main.js
‚îÇ   ‚îú‚îÄ‚îÄ preload.js
‚îÇ   ‚îî‚îÄ‚îÄ services/      # Backend services
‚îÇ       ‚îú‚îÄ‚îÄ api.js     # HTTP client
‚îÇ       ‚îú‚îÄ‚îÄ vosk.js    # STT engine
‚îÇ       ‚îú‚îÄ‚îÄ vad.js     # Voice Activity Detection
‚îÇ       ‚îî‚îÄ‚îÄ storage.js # SQLite outbox
‚îú‚îÄ‚îÄ src/               # React app
‚îÇ   ‚îú‚îÄ‚îÄ pages/         # UI pages
‚îÇ   ‚îú‚îÄ‚îÄ components/    # Reusable components
‚îÇ   ‚îú‚îÄ‚îÄ store/         # Zustand stores
‚îÇ   ‚îî‚îÄ‚îÄ services/      # Frontend services
‚îî‚îÄ‚îÄ public/
    ‚îî‚îÄ‚îÄ vosk-model/    # Vosk language model
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π

#### Vosk STT Integration

```javascript
// electron/services/vosk.js
const Vosk = require('vosk');

class VoskRecognizer {
  async initialize() {
    this.model = new Vosk.Model('path/to/model');
    this.recognizer = new Vosk.Recognizer({
      model: this.model,
      sampleRate: 16000
    });
  }
  
  processAudio(audioBuffer) {
    this.recognizer.acceptWaveform(audioBuffer);
    return this.recognizer.result();
  }
}
```

#### VAD (Voice Activity Detection)

```javascript
// electron/services/vad.js
import { MicVAD } from '@ricky0123/vad-web';

const vad = await MicVAD.new({
  onSpeechStart: () => console.log('Speech started'),
  onSpeechEnd: (audio) => processAudio(audio),
  positiveSpeechThreshold: 0.8
});
```

## Troubleshooting

### –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ API

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ backend –∑–∞–ø—É—â–µ–Ω –∏ –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ `http://localhost:8000`. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `VITE_API_URL` –≤ `.env`.

### OTP –Ω–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ Telegram –±–æ—Ç –∑–∞–ø—É—â–µ–Ω
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –ø–∞—Ü–∏–µ–Ω—Ç–∞ –µ—Å—Ç—å –ø—Ä–∏–≤—è–∑–∫–∞ –∫ Telegram
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `TELEGRAM_BOT_TOKEN` –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö backend

### –ü—Ä–æ–±–ª–µ–º—ã —Å –º–∏–∫—Ä–æ—Ñ–æ–Ω–æ–º

1. –†–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –±—Ä–∞—É–∑–µ—Ä–∞/Electron
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –º–∏–∫—Ä–æ—Ñ–æ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –¥—Ä—É–≥–∏—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö
3. –í production –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS (–¥–ª—è WebRTC)

## TODO

- [ ] –ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Vosk STT
- [ ] Voice Activity Detection
- [ ] SQLite offline storage
- [ ] Auto-update mechanism
- [ ] E2E —Ç–µ—Å—Ç—ã
- [ ] Packaging –¥–ª—è Windows/Mac/Linux

## License

MIT

