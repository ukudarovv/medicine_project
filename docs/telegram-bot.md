# Telegram Bot –¥–ª—è –∫–ª–∏–Ω–∏–∫–∏ - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

## –û–±–∑–æ—Ä

–ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π Telegram-–±–æ—Ç –¥–ª—è –∫–∞–∑–∞—Ö—Å—Ç–∞–Ω—Å–∫–æ–π –∫–ª–∏–Ω–∏–∫–∏ —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π –≤ EHR —Å–∏—Å—Ç–µ–º—É. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤, –æ–Ω–ª–∞–π–Ω-–∑–∞–ø–∏—Å—å, –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è, –¥–æ–∫—É–º–µ–Ω—Ç—ã, –æ–ø–ª–∞—Ç—ã –∏ —Ç–∞—Ä–≥–µ—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–∞—Å—Å—ã–ª–∫–∏ –Ω–∞ —Ä—É—Å—Å–∫–æ–º –∏ –∫–∞–∑–∞—Ö—Å–∫–æ–º —è–∑—ã–∫–∞—Ö.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Telegram API   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ   Aiogram Bot   ‚îÇ
    ‚îÇ   (Python 3.11) ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ  Redis (FSM)     ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ  Django REST API ‚îÇ
    ‚îÇ  Authentication  ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ  PostgreSQL      ‚îÇ
    ‚îÇ  (EHR Database)  ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1. Django Backend (`backend/apps/telegram_bot/`)

#### –ú–æ–¥–µ–ª–∏
- **PatientTelegramLink** - —Å–≤—è–∑—å –ø–∞—Ü–∏–µ–Ω—Ç–∞ —Å Telegram –∞–∫–∫–∞—É–Ω—Ç–æ–º
- **BotBroadcast** - —Ä–∞—Å—Å—ã–ª–∫–∏
- **BotDocument** - –¥–æ–∫—É–º–µ–Ω—Ç—ã –¥–ª—è –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤
- **BotAudit** - –∞—É–¥–∏—Ç –¥–µ–π—Å—Ç–≤–∏–π
- **BotFeedback** - NPS –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
- **SupportTicket** - –æ–±—Ä–∞—â–µ–Ω–∏—è –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É

#### API Endpoints

##### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞—Ü–∏–µ–Ω—Ç–∞–º–∏
- `POST /api/bot/patient/upsert/` - —Å–æ–∑–¥–∞—Ç—å/–æ–±–Ω–æ–≤–∏—Ç—å –ø–∞—Ü–∏–µ–Ω—Ç–∞
- `POST /api/bot/patient/verify-iin/` - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ò–ò–ù
- `GET /api/bot/patient/by-telegram/<telegram_user_id>/` - –ø–æ–ª—É—á–∏—Ç—å –ø–æ Telegram ID

##### –ó–∞–ø–∏—Å—å –Ω–∞ –ø—Ä–∏—ë–º
- `GET /api/bot/branches/` - —Å–ø–∏—Å–æ–∫ —Ñ–∏–ª–∏–∞–ª–æ–≤
- `GET /api/bot/services/?branch_id=` - —É—Å–ª—É–≥–∏ –ø–æ —Ñ–∏–ª–∏–∞–ª—É
- `GET /api/bot/doctors/?service_id=&date=` - –≤—Ä–∞—á–∏
- `GET /api/bot/slots/?doctor_id=&date=` - –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Å–ª–æ—Ç—ã
- `POST /api/bot/appointments/` - —Å–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å—å
- `GET /api/bot/appointments/my/?telegram_user_id=` - –º–æ–∏ –∑–∞–ø–∏—Å–∏
- `PATCH /api/bot/appointments/<id>/` - –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –∑–∞–ø–∏—Å—å
- `POST /api/bot/appointments/<id>/cancel/` - –æ—Ç–º–µ–Ω–∏—Ç—å –∑–∞–ø–∏—Å—å

##### –î–æ–∫—É–º–µ–Ω—Ç—ã
- `GET /api/bot/documents/?telegram_user_id=&type=` - —Å–ø–∏—Å–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- `POST /api/bot/documents/generate/` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è PDF
- `GET /api/bot/documents/<id>/download/` - —Å—Å—ã–ª–∫–∞ –Ω–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ (TTL 48h)

##### –û–ø–ª–∞—Ç—ã
- `POST /api/bot/payments/invoice/` - —Å–æ–∑–¥–∞—Ç—å —Å—á—ë—Ç
- `GET /api/bot/payments/<id>/status/` - —Å—Ç–∞—Ç—É—Å –æ–ø–ª–∞—Ç—ã
- `POST /api/bot/payments/callback/` - webhook –æ—Ç –ø–ª–∞—Ç—ë–∂–Ω—ã—Ö —Å–∏—Å—Ç–µ–º
- `GET /api/bot/payments/balance/?telegram_user_id=` - –±–∞–ª–∞–Ω—Å –ø–∞—Ü–∏–µ–Ω—Ç–∞

##### –û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
- `POST /api/bot/feedback/` - —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å NPS –æ—Ü–µ–Ω–∫—É

##### –ü–æ–¥–¥–µ—Ä–∂–∫–∞
- `POST /api/bot/support/ticket/` - —Å–æ–∑–¥–∞—Ç—å –æ–±—Ä–∞—â–µ–Ω–∏–µ
- `GET /api/bot/support/faq/` - FAQ —Å–ø–∏—Å–æ–∫

##### –†–∞—Å—Å—ã–ª–∫–∏ (–∞–¥–º–∏–Ω)
- `POST /api/bot/broadcast/create/` - —Å–æ–∑–¥–∞—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É
- `POST /api/bot/broadcast/<id>/start/` - –∑–∞–ø—É—Å—Ç–∏—Ç—å
- `GET /api/bot/broadcast/<id>/stats/` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

#### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

**BotAPIAuthentication:**
```python
Authorization: Bearer <TELEGRAM_BOT_API_SECRET>
```

–í—Å–µ bot API endpoints –∑–∞—â–∏—â–µ–Ω—ã JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π.

### 2. Telegram Bot (`telegram_bot/`)

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```
telegram_bot/
‚îú‚îÄ‚îÄ main.py              # Entry point
‚îú‚îÄ‚îÄ config.py            # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ handlers/            # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥
‚îÇ   ‚îú‚îÄ‚îÄ start.py         # –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ booking.py       # –ó–∞–ø–∏—Å—å
‚îÇ   ‚îú‚îÄ‚îÄ my_appointments.py
‚îÇ   ‚îú‚îÄ‚îÄ documents.py
‚îÇ   ‚îú‚îÄ‚îÄ payments.py
‚îÇ   ‚îú‚îÄ‚îÄ feedback.py
‚îÇ   ‚îú‚îÄ‚îÄ support.py
‚îÇ   ‚îî‚îÄ‚îÄ profile.py
‚îú‚îÄ‚îÄ keyboards/           # –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ inline.py        # Inline –∫–Ω–æ–ø–∫–∏
‚îÇ   ‚îî‚îÄ‚îÄ reply.py         # Reply –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
‚îú‚îÄ‚îÄ states/              # FSM —Å–æ—Å—Ç–æ—è–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ registration.py
‚îÇ   ‚îî‚îÄ‚îÄ booking.py
‚îú‚îÄ‚îÄ middlewares/         # Middleware
‚îÇ   ‚îú‚îÄ‚îÄ i18n.py          # –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ auth.py          # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ services/            # –°–µ—Ä–≤–∏—Å—ã
‚îÇ   ‚îú‚îÄ‚îÄ api_client.py    # Django API client
‚îÇ   ‚îî‚îÄ‚îÄ helpers.py       # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
‚îî‚îÄ‚îÄ locales/             # –ü–µ—Ä–µ–≤–æ–¥—ã
    ‚îú‚îÄ‚îÄ ru.json
    ‚îî‚îÄ‚îÄ kk.json
```

#### FSM –î–∏–∞–≥—Ä–∞–º–º—ã

##### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è

```
/start
  ‚Üì
–í—ã–±–æ—Ä —è–∑—ã–∫–∞ (RU/KK)
  ‚Üì
–í–≤–æ–¥ –∏–º–µ–Ω–∏
  ‚Üì
–í–≤–æ–¥ —Ñ–∞–º–∏–ª–∏–∏
  ‚Üì
–í–≤–æ–¥ –æ—Ç—á–µ—Å—Ç–≤–∞ (optional)
  ‚Üì
–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞
  ‚Üì
–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è
  ‚Üì
–ü–æ–ª (M/F)
  ‚Üì
–ò–ò–ù (–≤–∞–ª–∏–¥–∞—Ü–∏—è)
  ‚Üì
–°–æ–≥–ª–∞—Å–∏—è (–ü–î–Ω, –º–µ–¥–≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–æ, –º–∞—Ä–∫–µ—Ç–∏–Ω–≥)
  ‚Üì
–°–æ–∑–¥–∞–Ω–∏–µ –≤ Django
  ‚Üì
–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
```

##### –ó–∞–ø–∏—Å—å –Ω–∞ –ø—Ä–∏—ë–º

```
–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é ‚Üí "–ó–∞–ø–∏—Å–∞—Ç—å—Å—è"
  ‚Üì
–í—ã–±–æ—Ä —Ñ–∏–ª–∏–∞–ª–∞
  ‚Üì
–í—ã–±–æ—Ä —É—Å–ª—É–≥–∏
  ‚Üì
–í—ã–±–æ—Ä –≤—Ä–∞—á–∞
  ‚Üì
–ö–∞–ª–µ–Ω–¥–∞—Ä—å (–≤—ã–±–æ—Ä –¥–∞—Ç—ã)
  ‚Üì
–í—ã–±–æ—Ä –≤—Ä–µ–º–µ–Ω–∏
  ‚Üì
–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
  ‚Üì
–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –ø—Ä–µ–¥–æ–ø–ª–∞—Ç–∞
  ‚Üì
–¢–∞–ª–æ–Ω (—Ç–µ–∫—Å—Ç + .ics —Ñ–∞–π–ª)
```

#### –ü—Ä–∏–º–µ—Ä—ã —Å–æ–æ–±—â–µ–Ω–∏–π

##### –†—É—Å—Å–∫–∏–π (RU)
```
–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –∫–ª–∏–Ω–∏–∫—É!

–Ø –ø–æ–º–æ–≥—É –≤–∞–º –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –ø—Ä–∏—ë–º, –ø–æ–ª—É—á–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã –∏ –º–Ω–æ–≥–æ–µ –¥—Ä—É–≥–æ–µ.

üìÖ –ó–∞–ø–∏—Å–∞—Ç—å—Å—è
üìã –ú–æ–∏ –∑–∞–ø–∏—Å–∏
üìÑ –î–æ–∫—É–º–µ–Ω—Ç—ã
üí≥ –û–ø–ª–∞—Ç–∞
üë§ –ü—Ä–æ—Ñ–∏–ª—å
‚ùì –ü–æ–¥–¥–µ—Ä–∂–∫–∞
```

##### –ö–∞–∑–∞—Ö—Å–∫–∏–π (KK)
```
–ö–ª–∏–Ω–∏–∫–∞“ì–∞ “õ–æ—à –∫–µ–ª–¥—ñ“£—ñ–∑!

–ú–µ–Ω —Å—ñ–∑–≥–µ “õ–∞–±—ã–ª–¥–∞—É“ì–∞ –∂–∞–∑—ã–ª—É“ì–∞, “õ“±–∂–∞—Ç—Ç–∞—Ä–¥—ã –∞–ª—É“ì–∞ –∂”ô–Ω–µ —Ç.–±. –∫”©–º–µ–∫—Ç–µ—Å–µ–º—ñ–Ω.

üìÖ –ñ–∞–∑—ã–ª—É
üìã –ú–µ–Ω—ñ“£ –∂–∞–∑—É–ª–∞—Ä—Ç—ã–º
üìÑ “ö“±–∂–∞—Ç—Ç–∞—Ä
üí≥ –¢”©–ª–µ–º–¥–µ—Ä
üë§ –ü—Ä–æ—Ñ–∏–ª—å
‚ùì –ö”©–º–µ–∫
```

## Celery Tasks

–ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞—á–∏ –¥–ª—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π:

```python
# –ö–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç
send_appointment_reminders()
  - D-1: –∑–∞ –¥–µ–Ω—å –¥–æ –ø—Ä–∏—ë–º–∞
  - H-3: –∑–∞ 3 —á–∞—Å–∞
  - H-1: –∑–∞ —á–∞—Å

# –ö–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
send_arrived_check()
  - "–í—ã –ø—Ä–∏—à–ª–∏?" —á–µ—Ä–µ–∑ 5 –º–∏–Ω –ø–æ—Å–ª–µ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–ø–∏—Å–∏

# –ö–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç
send_feedback_request()
  - NPS –æ–ø—Ä–æ—Å —á–µ—Ä–µ–∑ 2 —á–∞—Å–∞ –ø–æ—Å–ª–µ –≤–∏–∑–∏—Ç–∞

# –ö–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤
cleanup_expired_documents()
  - –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö —Å—Å—ã–ª–æ–∫ –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç—ã
```

## –°–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è —Ä–∞—Å—Å—ã–ª–æ–∫

–§–∏–ª—å—Ç—Ä—ã –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤:
- **–í–æ–∑—Ä–∞—Å—Ç**: age_min, age_max
- **–ü–æ–ª**: M/F
- **–£—Å–ª—É–≥–∏**: —Å–ø–∏—Å–æ–∫ service_id (–∫—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª)
- **–¢–µ–≥–∏**: —Ç–µ–≥–∏ –ø–∞—Ü–∏–µ–Ω—Ç–∞
- **–û–°–ú–°**: —Å—Ç–∞—Ç—É—Å —Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏—è
- **–ü–æ—Å–ª–µ–¥–Ω–∏–π –≤–∏–∑–∏—Ç**: –¥–∞—Ç–∞ –æ—Ç/–¥–æ
- **–ß–∞—Å—Ç–æ—Ç–∞ –≤–∏–∑–∏—Ç–æ–≤**: –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ

–ü—Ä–∏–º–µ—Ä:
```python
{
  "age_min": 18,
  "age_max": 65,
  "sex": "F",
  "services": [1, 5, 7],
  "osms_status": "insured",
  "last_visit_from": "2025-01-01",
  "min_visits": 3
}
```

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –±–æ—Ç–∞ –≤ @BotFather

```
/newbot
# –°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º
# –ü–æ–ª—É—á–∏—Ç–µ TOKEN
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ .env

```bash
TELEGRAM_BOT_TOKEN=123456789:ABCdefGHIjklMNOpqrsTUVwxyz
TELEGRAM_BOT_API_SECRET=your-secret-key-here
TELEGRAM_WEBHOOK_URL=https://your-domain.com/api/bot/webhook
USE_WEBHOOK=false  # true –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
```

### 3. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏

```bash
cd backend
python manage.py makemigrations telegram_bot
python manage.py migrate
```

### 4. –ó–∞–ø—É—Å–∫ —Å Docker Compose

```bash
docker-compose up -d telegram_bot
```

### 5. –ü—Ä–æ–≤–µ—Ä–∫–∞

```bash
# –õ–æ–≥–∏ –±–æ—Ç–∞
docker-compose logs -f telegram_bot

# –û—Ç–ø—Ä–∞–≤—å—Ç–µ /start –≤ Telegram
```

## –†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã

### Development (Polling)
```
USE_WEBHOOK=false
```
–ë–æ—Ç –æ–ø—Ä–∞—à–∏–≤–∞–µ—Ç Telegram API –∫–∞–∂–¥—ã–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥.

### Production (Webhook)
```
USE_WEBHOOK=true
TELEGRAM_WEBHOOK_URL=https://your-domain.com/api/bot/webhook
```
Telegram –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–∞ –≤–∞—à —Å–µ—Ä–≤–µ—Ä.

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

1. **Bot API Authentication**: JWT token –¥–ª—è –∑–∞—â–∏—Ç—ã Django endpoints
2. **Webhook Secret**: —Å–µ–∫—Ä–µ—Ç–Ω—ã–π —Ç–æ–∫–µ–Ω –¥–ª—è webhook
3. **Rate Limiting**: Redis-based –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ (middleware)
4. **Document TTL**: –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç—ã (48 —á–∞—Å–æ–≤)
5. **–ü–î–Ω —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ**: —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ú–µ—Ç—Ä–∏–∫–∏
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π (–ø–æ —Ç–∏–ø—É)
- –í—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞ API
- –û—à–∏–±–∫–∏ (Sentry)
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### –õ–æ–≥–∏
```bash
# –ë–æ—Ç
docker-compose logs telegram_bot

# Django API
docker-compose logs backend | grep telegram_bot

# Celery tasks
docker-compose logs celery_worker | grep telegram_bot
```

## Troubleshooting

### –ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `docker-compose logs telegram_bot`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ TOKEN –≤ .env
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Redis
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Django API

### –û—à–∏–±–∫–∏ API
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ TELEGRAM_BOT_API_SECRET (–¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å)
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏: `python manage.py migrate`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Django

### Webhook –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ HTTPS –Ω–∞—Å—Ç—Ä–æ–µ–Ω
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ TELEGRAM_WEBHOOK_URL
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ webhook —Å—Ç–∞—Ç—É—Å: `https://api.telegram.org/bot<TOKEN>/getWebhookInfo`

## –î–∞–ª—å–Ω–µ–π—à–µ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ

### –ü–ª–∞–Ω–∏—Ä—É–µ–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- [ ] –û–Ω–ª–∞–π–Ω-–∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ –±–æ—Ç–∞
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Kaspi/Halyk (—Ä–µ–∞–ª—å–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏)
- [ ] –ì—Ä—É–ø–ø–æ–≤—ã–µ –∑–∞–ø–∏—Å–∏ (—Å–µ–º–µ–π–Ω—ã–µ –ø—Ä–∏—ë–º—ã)
- [ ] Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö –∞–Ω–∞–ª–∏–∑–æ–≤
- [ ] –ß–∞—Ç-–±–æ—Ç —Å AI –¥–ª—è –ø–µ—Ä–≤–∏—á–Ω–æ–π –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏
- [ ] –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏—è –¥–æ –∫–ª–∏–Ω–∏–∫–∏

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- [ ] –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Redis (branches, services)
- [ ] Webhook –æ—á–µ—Ä–µ–¥–∏ (–ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ)
- [ ] Batch –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ä–∞—Å—Å—ã–ª–æ–∫
- [ ] CDN –¥–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ä–µ—Å—É—Ä—Å–æ–≤ (QR –∫–æ–¥—ã)

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–î–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π:
- GitHub Issues: https://github.com/ukudarovv/medicine_project/issues
- Email: support@clinic.example.com

---

**Version:** 1.0.0  
**Last Updated:** 2025-11-05  
**Author:** Kudarov Umar

