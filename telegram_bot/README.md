# ü§ñ Telegram Bot –¥–ª—è Medicine ERP

Telegram –±–æ—Ç –¥–ª—è –∑–∞–ø–∏—Å–∏ –Ω–∞ –ø—Ä–∏—ë–º, –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –ø–∞—Ü–∏–µ–Ω—Ç–∞–º–∏.

## üìã –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

- [–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏](#–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏)
- [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
- [Endpoints](#endpoints)
- [–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç](#–±—ã—Å—Ç—Ä—ã–π-—Å—Ç–∞—Ä—Ç)
- [–ù–∞—Å—Ç—Ä–æ–π–∫–∞](#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞)
- [–†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã](#—Ä–µ–∂–∏–º—ã-—Ä–∞–±–æ—Ç—ã)
- [–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞](#—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞)
- [Production Deploy](#production-deploy)

## ‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –î–ª—è –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤:
- üìù **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è** - —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è —á–µ—Ä–µ–∑ –±–æ—Ç–∞
- üóìÔ∏è **–ó–∞–ø–∏—Å—å –Ω–∞ –ø—Ä–∏—ë–º** - –≤—ã–±–æ—Ä —Ñ–∏–ª–∏–∞–ª–∞, —É—Å–ª—É–≥–∏, –≤—Ä–∞—á–∞ –∏ –≤—Ä–µ–º–µ–Ω–∏
- üìã **–ú–æ–∏ –∑–∞–ø–∏—Å–∏** - –ø—Ä–æ—Å–º–æ—Ç—Ä, –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∏ –æ—Ç–º–µ–Ω–∞ –∑–∞–ø–∏—Å–µ–π
- üìÑ **–î–æ–∫—É–º–µ–Ω—Ç—ã** - –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–ø—Ä–∞–≤–æ–∫ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∞–Ω–∞–ª–∏–∑–æ–≤
- üí≥ **–û–ø–ª–∞—Ç–∞** - –æ–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ Kaspi QR
- ‚≠ê **–û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å** - NPS –æ–ø—Ä–æ—Å—ã –∏ –æ—Ç–∑—ã–≤—ã
- üÜò **–ü–æ–¥–¥–µ—Ä–∂–∫–∞** - —Ç–∏–∫–µ—Ç—ã –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É –∏ FAQ

### –î–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤:
- üì¢ **–†–∞—Å—Å—ã–ª–∫–∏** - —Å–µ–≥–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–∞—Å—Å–æ–≤—ã–µ —Ä–∞—Å—Å—ã–ª–∫–∏
- üìä **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞** - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ä–∞—Å—Å—ã–ª–∫–∞–º

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
telegram_bot/
‚îú‚îÄ‚îÄ handlers/          # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥ –∏ —Å–æ–æ–±—â–µ–Ω–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ start.py      # –ö–æ–º–∞–Ω–¥–∞ /start –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ booking.py    # –ó–∞–ø–∏—Å—å –Ω–∞ –ø—Ä–∏—ë–º
‚îÇ   ‚îú‚îÄ‚îÄ my_appointments.py  # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å—è–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ documents.py  # –î–æ–∫—É–º–µ–Ω—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ payments.py   # –û–ø–ª–∞—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ feedback.py   # –û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
‚îÇ   ‚îú‚îÄ‚îÄ support.py    # –ü–æ–¥–¥–µ—Ä–∂–∫–∞
‚îÇ   ‚îî‚îÄ‚îÄ profile.py    # –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚îú‚îÄ‚îÄ keyboards/         # –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ inline.py     # Inline –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
‚îÇ   ‚îî‚îÄ‚îÄ reply.py      # Reply –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
‚îú‚îÄ‚îÄ middlewares/       # Middleware
‚îÇ   ‚îú‚îÄ‚îÄ auth.py       # –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ i18n.py       # –ò–Ω—Ç–µ—Ä–Ω–∞—Ü–∏–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è
‚îú‚îÄ‚îÄ services/          # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ api_client.py # –ö–ª–∏–µ–Ω—Ç Django API
‚îÇ   ‚îî‚îÄ‚îÄ helpers.py    # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
‚îú‚îÄ‚îÄ states/            # FSM —Å–æ—Å—Ç–æ—è–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ booking.py    # –°–æ—Å—Ç–æ—è–Ω–∏—è –¥–ª—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ registration.py # –°–æ—Å—Ç–æ—è–Ω–∏—è –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ locales/           # –ü–µ—Ä–µ–≤–æ–¥—ã
‚îÇ   ‚îú‚îÄ‚îÄ ru.json       # –†—É—Å—Å–∫–∏–π
‚îÇ   ‚îî‚îÄ‚îÄ kk.json       # –ö–∞–∑–∞—Ö—Å–∫–∏–π
‚îú‚îÄ‚îÄ config.py          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ main.py            # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îú‚îÄ‚îÄ requirements.txt   # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îî‚îÄ‚îÄ Dockerfile         # Docker –æ–±—Ä–∞–∑
```

## üîå Endpoints

–ë–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ endpoints Django API (`/api/bot/`):

### Patient Management
- `POST /api/bot/patient/upsert/` - —Å–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ü–∏–µ–Ω—Ç–∞
- `POST /api/bot/patient/verify-iin/` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ò–ò–ù
- `GET /api/bot/patient/by-telegram/{id}/` - –ø–æ–ª—É—á–µ–Ω–∏–µ –ø–∞—Ü–∏–µ–Ω—Ç–∞ –ø–æ Telegram ID

### Booking
- `GET /api/bot/branches/` - —Å–ø–∏—Å–æ–∫ —Ñ–∏–ª–∏–∞–ª–æ–≤
- `GET /api/bot/services/` - —Å–ø–∏—Å–æ–∫ —É—Å–ª—É–≥
- `GET /api/bot/doctors/` - —Å–ø–∏—Å–æ–∫ –≤—Ä–∞—á–µ–π
- `GET /api/bot/slots/` - –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Å–ª–æ—Ç—ã
- `POST /api/bot/appointments/` - —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏
- `GET /api/bot/appointments/my/` - –º–æ–∏ –∑–∞–ø–∏—Å–∏
- `PATCH /api/bot/appointments/{id}/` - –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏
- `POST /api/bot/appointments/{id}/cancel/` - –æ—Ç–º–µ–Ω–∞ –∑–∞–ø–∏—Å–∏

### Documents
- `GET /api/bot/documents/` - —Å–ø–∏—Å–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- `POST /api/bot/documents/generate/` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞
- `GET /api/bot/documents/{id}/download/` - —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞

### Payments
- `POST /api/bot/payments/invoice/` - —Å–æ–∑–¥–∞–Ω–∏–µ —Å—á—ë—Ç–∞
- `GET /api/bot/payments/{id}/status/` - —Å—Ç–∞—Ç—É—Å –æ–ø–ª–∞—Ç—ã
- `GET /api/bot/payments/balance/` - –±–∞–ª–∞–Ω—Å –ø–∞—Ü–∏–µ–Ω—Ç–∞

### Feedback & Support
- `POST /api/bot/feedback/` - —Å–æ–∑–¥–∞–Ω–∏–µ –æ—Ç–∑—ã–≤–∞
- `POST /api/bot/support/ticket/` - —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∏–∫–µ—Ç–∞
- `GET /api/bot/support/faq/` - FAQ

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

1. **Telegram Bot Token**
   - –°–æ–∑–¥–∞–π—Ç–µ –±–æ—Ç–∞ —á–µ—Ä–µ–∑ [@BotFather](https://t.me/BotFather)
   - –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π token

2. **Backend –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω**
   - Django API –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞ `http://backend:8000`

### –®–∞–≥ 1: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ:

```env
# Telegram Bot Settings
TELEGRAM_BOT_TOKEN=123456789:ABCdefGHIjklMNOpqrsTUVwxyz  # –í–∞—à —Ç–æ–∫–µ–Ω –æ—Ç BotFather
TELEGRAM_BOT_API_SECRET=your-secret-key-123              # –°–µ–∫—Ä–µ—Ç –¥–ª—è API (–ø—Ä–∏–¥—É–º–∞–π—Ç–µ —Å–ª–æ–∂–Ω—ã–π)

# Webhook (–¥–ª—è production, –æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è development)
TELEGRAM_WEBHOOK_URL=
TELEGRAM_WEBHOOK_SECRET=change-this-webhook-secret

# –†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã (false = polling –¥–ª—è dev, true = webhook –¥–ª—è prod)
USE_WEBHOOK=false

# Default organization ID
DEFAULT_ORGANIZATION_ID=1
```

### –®–∞–≥ 2: –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker Compose

```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ (–≤–∫–ª—é—á–∞—è –±–æ—Ç–∞)
docker-compose up -d

# –ò–ª–∏ —Ç–æ–ª—å–∫–æ –±–æ—Ç–∞ (–µ—Å–ª–∏ –æ—Å—Ç–∞–ª—å–Ω–æ–µ —É–∂–µ –∑–∞–ø—É—â–µ–Ω–æ)
docker-compose up -d telegram_bot

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –±–æ—Ç–∞
docker-compose logs -f telegram_bot

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞
docker-compose stop telegram_bot
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞

1. –ù–∞–π–¥–∏—Ç–µ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞ –≤ Telegram
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/start`
3. –ë–æ—Ç –¥–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—Ç–∏—Ç—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|------------|----------|--------------|
| `TELEGRAM_BOT_TOKEN` | Token –æ—Ç @BotFather | - (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ) |
| `TELEGRAM_BOT_API_SECRET` | –°–µ–∫—Ä–µ—Ç –¥–ª—è Django API | `change-this-secret-in-production` |
| `DJANGO_API_URL` | URL Django API | `http://backend:8000` |
| `REDIS_HOST` | Redis —Ö–æ—Å—Ç | `redis` |
| `REDIS_PORT` | Redis –ø–æ—Ä—Ç | `6379` |
| `REDIS_DB` | Redis database | `1` |
| `USE_WEBHOOK` | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å webhook | `false` |
| `TELEGRAM_WEBHOOK_URL` | URL –¥–ª—è webhook | - |
| `TELEGRAM_WEBHOOK_SECRET` | –°–µ–∫—Ä–µ—Ç webhook | `change-this-webhook-secret` |
| `DEFAULT_ORGANIZATION_ID` | ID –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é | `1` |

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

–ë–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Bearer token –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –¥–ª—è –æ–±—â–µ–Ω–∏—è —Å Django API:

```python
headers = {
    'Authorization': f'Bearer {TELEGRAM_BOT_API_SECRET}',
    'Content-Type': 'application/json'
}
```

**‚ö†Ô∏è –í–∞–∂–Ω–æ:** `TELEGRAM_BOT_API_SECRET` –¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å –Ω–∞ –æ–±–µ–∏—Ö —Å—Ç–æ—Ä–æ–Ω–∞—Ö:
- –í `.env` –¥–ª—è –±–æ—Ç–∞
- –í `.env` –¥–ª—è backend (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ `backend/apps/telegram_bot/permissions.py`)

## üîÑ –†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã

### Polling Mode (Development)

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏**

```env
USE_WEBHOOK=false
```

–ë–æ—Ç —Å–∞–º –æ–ø—Ä–∞—à–∏–≤–∞–µ—Ç Telegram API –∫–∞–∂–¥—ã–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥.

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ü—Ä–æ—Å—Ç–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ
- ‚úÖ –ù–µ —Ç—Ä–µ–±—É–µ—Ç –ø—É–±–ª–∏—á–Ω–æ–≥–æ URL

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- ‚ùå –ó–∞–¥–µ—Ä–∂–∫–∞ –≤ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚ùå –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ Telegram API

### Webhook Mode (Production)

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è production**

```env
USE_WEBHOOK=true
TELEGRAM_WEBHOOK_URL=https://yourdomain.com
TELEGRAM_WEBHOOK_SECRET=your-secret-123
```

Telegram –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–∞ –≤–∞—à —Å–µ—Ä–≤–µ—Ä.

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚úÖ –ú–µ–Ω—å—à–µ –Ω–∞–≥—Ä—É–∑–∫–∏
- ‚úÖ –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- –ü—É–±–ª–∏—á–Ω—ã–π HTTPS URL
- –í–∞–ª–∏–¥–Ω—ã–π SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç

## üõ†Ô∏è –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –±–µ–∑ Docker

```bash
cd telegram_bot

# –°–æ–∑–¥–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt

# –ù–∞—Å—Ç—Ä–æ–∏—Ç—å .env
cp ../.env .env

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
python main.py
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

–ü—Ä–∏–º–µ—Ä –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞:

```python
from aiogram import Router
from aiogram.filters import Command
from aiogram.types import Message

router = Router()

@router.message(Command('start'))
async def cmd_start(message: Message):
    await message.answer('–ü—Ä–∏–≤–µ—Ç! üëã')
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞

1. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª –≤ `handlers/` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `new_feature.py`)
2. –°–æ–∑–¥–∞–π—Ç–µ Router –∏ –¥–æ–±–∞–≤—å—Ç–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
3. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ –≤ `main.py`:

```python
from handlers import new_feature

# –í —Ñ—É–Ω–∫—Ü–∏–∏ create_dispatcher():
dp.include_router(new_feature.router)
```

### –°–æ—Å—Ç–æ—è–Ω–∏—è (FSM)

–î–ª—è –º–Ω–æ–≥–æ—à–∞–≥–æ–≤—ã—Ö –¥–∏–∞–ª–æ–≥–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ FSM:

```python
from aiogram.fsm.state import State, StatesGroup

class BookingStates(StatesGroup):
    waiting_for_branch = State()
    waiting_for_service = State()
    waiting_for_doctor = State()
    waiting_for_date = State()
```

### –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è

–ü–µ—Ä–µ–≤–æ–¥—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ `locales/`:

```json
{
  "welcome": "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!",
  "menu": {
    "booking": "üìÖ –ó–∞–ø–∏—Å–∞—Ç—å—Å—è",
    "my_appointments": "üìã –ú–æ–∏ –∑–∞–ø–∏—Å–∏"
  }
}
```

## üöÄ Production Deploy

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ webhook

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å webhook
curl -X POST "https://api.telegram.org/bot<YOUR_BOT_TOKEN>/setWebhook" \
  -H "Content-Type: application/json" \
  -d '{
    "url": "https://yourdomain.com/api/bot/webhook/",
    "secret_token": "your-webhook-secret"
  }'

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å webhook
curl "https://api.telegram.org/bot<YOUR_BOT_TOKEN>/getWebhookInfo"
```

### 2. Docker Compose –¥–ª—è production

```yaml
telegram_bot:
  build: ./telegram_bot
  environment:
    - USE_WEBHOOK=true
    - TELEGRAM_WEBHOOK_URL=https://yourdomain.com
  restart: always
  deploy:
    replicas: 1
    resources:
      limits:
        cpus: '0.5'
        memory: 512M
```

### 3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

```bash
# –õ–æ–≥–∏
docker-compose logs -f telegram_bot

# –°—Ç–∞—Ç—É—Å
docker-compose ps telegram_bot

# Health check
docker inspect telegram_bot | grep Health
```

### 4. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ:**
- üîí –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∏–ª—å–Ω—ã–µ —Å–µ–∫—Ä–µ—Ç—ã –¥–ª—è `TELEGRAM_BOT_API_SECRET`
- üîí –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS –¥–ª—è webhook
- üîí –í–∞–ª–∏–¥–∏—Ä—É–π—Ç–µ `secret_token` –≤ webhook
- üîí –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ `/api/bot/` —Ç–æ–ª—å–∫–æ –¥–ª—è –±–æ—Ç–∞
- üîí –†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ—Ç–ª–∞–¥–∫–∞

### –õ–æ–≥–∏

–ë–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ Python:

```python
import logging
logger = logging.getLogger(__name__)

logger.info("–°–æ–æ–±—â–µ–Ω–∏–µ")
logger.warning("–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ")
logger.error("–û—à–∏–±–∫–∞")
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤

```bash
# –ü–æ—Å–ª–µ–¥–Ω–∏–µ 100 —Å—Ç—Ä–æ–∫
docker-compose logs --tail=100 telegram_bot

# –°–ª–µ–¥–∏—Ç—å –∑–∞ –ª–æ–≥–∞–º–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
docker-compose logs -f telegram_bot

# –õ–æ–≥–∏ —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –º–µ—Ç–∫–∞–º–∏
docker-compose logs -t telegram_bot
```

### Health Check

Docker –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∑–¥–æ—Ä–æ–≤—å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
docker inspect telegram_bot | grep -A 10 Health
```

## üêõ Troubleshooting

### –ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–ø—É—â–µ–Ω:
   ```bash
   docker-compose ps telegram_bot
   ```

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:
   ```bash
   docker-compose logs telegram_bot
   ```

3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `TELEGRAM_BOT_TOKEN` –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π

4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Redis:
   ```bash
   docker-compose exec telegram_bot python -c "import redis; r = redis.Redis(host='redis'); print(r.ping())"
   ```

### Backend –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ backend –∑–∞–ø—É—â–µ–Ω:
   ```bash
   docker-compose ps backend
   ```

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `DJANGO_API_URL` –≤ `.env`

3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `TELEGRAM_BOT_API_SECRET` (–¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å –Ω–∞ –æ–±–µ–∏—Ö —Å—Ç–æ—Ä–æ–Ω–∞—Ö)

### Webhook –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ webhook info:
   ```bash
   curl "https://api.telegram.org/bot<TOKEN>/getWebhookInfo"
   ```

2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ URL –¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞

3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç

4. –£–¥–∞–ª–∏—Ç–µ webhook –∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ polling:
   ```bash
   curl "https://api.telegram.org/bot<TOKEN>/deleteWebhook"
   ```

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [Aiogram Documentation](https://docs.aiogram.dev/)
- [Telegram Bot API](https://core.telegram.org/bots/api)
- [Django API Documentation](../docs/telegram-bot.md)
- [Architecture](../docs/architecture.md)

## ü§ù –ö–æ–Ω—Ç—Ä–∏–±—å—é—Ü–∏—è

1. Fork –ø—Ä–æ–µ–∫—Ç–∞
2. –°–æ–∑–¥–∞–π—Ç–µ feature branch (`git checkout -b feature/amazing-feature`)
3. Commit –∏–∑–º–µ–Ω–µ–Ω–∏–π (`git commit -m 'Add amazing feature'`)
4. Push –≤ branch (`git push origin feature/amazing-feature`)
5. –û—Ç–∫—Ä–æ–π—Ç–µ Pull Request

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç —è–≤–ª—è–µ—Ç—Å—è —á–∞—Å—Ç—å—é Medicine ERP —Å–∏—Å—Ç–µ–º—ã.

---

**–í–æ–ø—Ä–æ—Å—ã?** –°–æ–∑–¥–∞–π—Ç–µ issue –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –∏–ª–∏ —Å–≤—è–∂–∏—Ç–µ—Å—å —Å –∫–æ–º–∞–Ω–¥–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.

