# ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –û–®–ò–ë–ö–ò 500 - –°–î–ï–õ–ê–ù–û

## üîç –ß–¢–û –ë–´–õ–û –ò–°–ü–†–ê–í–õ–ï–ù–û

### 1. **PatientSerializer** - –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
- ‚úÖ –£–±—Ä–∞–Ω—ã KZ-–ø–æ–ª—è –∏–∑ `Meta.fields` (–æ–Ω–∏ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `to_representation()` –∫–æ—Ç–æ—Ä—ã–π **–±–µ–∑–æ–ø–∞—Å–Ω–æ** –¥–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–ª—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–Ω–∏ —Å—É—â–µ—Å—Ç–≤—É—é—Ç –≤ –ë–î
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `hasattr()` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞–ª–∏—á–∏—è –ø–æ–ª–µ–π

**–§–∞–π–ª:** `backend/apps/patients/serializers.py`

### 2. **VisitSerializer** - –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
- ‚úÖ –£–±—Ä–∞–Ω—ã Sprint 2 –ø–æ–ª—è –∏–∑ `Meta.fields`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `to_representation()` –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
- ‚úÖ `diary_structured`, `templates_used`, `files` –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤—É—é—Ç

**–§–∞–π–ª:** `backend/apps/visits/serializers.py`

### 3. **PatientViewSet** - –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π prefetch
- ‚úÖ –ò–∑–º–µ–Ω–µ–Ω `get_queryset()` —á—Ç–æ–±—ã –Ω–µ –ø–∞–¥–∞—Ç—å –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ `consent_history`
- ‚úÖ –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ `try-except` –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ `ConsentHistory`

**–§–∞–π–ª:** `backend/apps/patients/views.py`

### 4. **URLs** - –í—Ä–µ–º–µ–Ω–Ω–æ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã –Ω–æ–≤—ã–µ endpoints
- ‚úÖ –ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏–º–ø–æ—Ä—Ç—ã –Ω–æ–≤—ã—Ö ViewSets (Sprint 2-5)
- ‚úÖ –ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã `router.register()` –¥–ª—è –Ω–æ–≤—ã—Ö –º–æ–¥–µ–ª–µ–π
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è **–∫–æ–≥–¥–∞ —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å**

**–§–∞–π–ª:** `backend/apps/patients/urls.py`

### 5. **–°–∫—Ä–∏–ø—Ç –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–π**
- ‚úÖ –°–æ–∑–¥–∞–Ω PowerShell —Å–∫—Ä–∏–ø—Ç `APPLY_MIGRATIONS.ps1`
- ‚úÖ –ü—Ä–∏–º–µ–Ω—è–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è –≤—Å–µ—Ö 5 apps
- ‚úÖ –ó–∞–≥—Ä—É–∂–∞–µ—Ç KATO fixture

### 6. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**
- ‚úÖ –°–æ–∑–¥–∞–Ω `FIX_500_NOW.md` —Å –ø–æ—à–∞–≥–æ–≤–æ–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–µ–π
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `START_HERE.md` —Å —è—Ä–∫–æ–π —Å—Å—ã–ª–∫–æ–π –Ω–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
- ‚úÖ –°–æ–∑–¥–∞–Ω —ç—Ç–æ—Ç —Ñ–∞–π–ª —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º –æ—Ç—á–µ—Ç–æ–º

---

## üéØ –ß–¢–û –î–ï–õ–ê–¢–¨ –î–ê–õ–¨–®–ï

### –®–∞–≥ 1: –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ (2 –º–∏–Ω—É—Ç—ã)

–û—Ç–∫—Ä–æ–π—Ç–µ **`FIX_500_NOW.md`** –∏ —Å–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º.

–ò–ª–∏ –±—ã—Å—Ç—Ä–æ:
```bash
cd backend
python manage.py migrate
python manage.py loaddata kato
```

### –®–∞–≥ 2: –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–µ API

–í `backend/apps/patients/urls.py` –Ω–∞–π–¥–∏—Ç–µ –±–ª–æ–∫:
```python
# Import Sprint 2-5 ViewSets only after migrations are applied
# Uncomment these imports after running: python manage.py migrate
```

**–£–¥–∞–ª–∏—Ç–µ `#`** –≤ –Ω–∞—á–∞–ª–µ –≤—Å–µ—Ö —Å—Ç—Ä–æ–∫ —ç—Ç–æ–≥–æ –±–ª–æ–∫–∞.

### –®–∞–≥ 3: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Django

```bash
cd backend
python manage.py runserver
```

### –®–∞–≥ 4: –û–±–Ω–æ–≤–∏—Ç—å –±—Ä–∞—É–∑–µ—Ä

–ù–∞–∂–º–∏—Ç–µ `F5` –∏–ª–∏ `Ctrl+Shift+R`

---

## üß† –¢–ï–•–ù–ò–ß–ï–°–ö–û–ï –û–ë–™–Ø–°–ù–ï–ù–ò–ï

### –ü–æ—á–µ–º—É –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –æ—à–∏–±–∫–∞ 500?

1. **–ù–æ–≤—ã–µ –ø–æ–ª—è –≤ –º–æ–¥–µ–ª—è—Ö** (–Ω–∞–ø—Ä–∏–º–µ—Ä, `iin_verified`, `osms_status`)
2. **Serializers –æ–∂–∏–¥–∞–ª–∏ —ç—Ç–∏ –ø–æ–ª—è** –≤ `Meta.fields`
3. **Django ORM –ø—ã—Ç–∞–ª—Å—è –ø–æ–ª—É—á–∏—Ç—å —ç—Ç–∏ –ø–æ–ª—è** –∏–∑ –ë–î
4. **–ù–æ –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–µ –±—ã–ª–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã**, –ø–æ—ç—Ç–æ–º—É –∫–æ–ª–æ–Ω–æ–∫ –≤ —Ç–∞–±–ª–∏—Ü–∞—Ö –Ω–µ—Ç
5. **–†–µ–∑—É–ª—å—Ç–∞—Ç:** `OperationalError` ‚Üí HTTP 500

### –ö–∞–∫ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ?

**–î–æ:**
```python
class PatientSerializer:
    class Meta:
        fields = [..., 'iin_verified', 'osms_status', ...]  # ‚ùå –ü–∞–¥–∞–µ—Ç –µ—Å–ª–∏ –ø–æ–ª–µ–π –Ω–µ—Ç –≤ –ë–î
```

**–ü–æ—Å–ª–µ:**
```python
class PatientSerializer:
    class Meta:
        fields = [..., 'iin', 'documents', ...]  # ‚úÖ –¢–æ–ª—å–∫–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—è
    
    def to_representation(self, instance):
        data = super().to_representation(instance)
        
        # ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ –¥–æ–±–∞–≤–ª—è–µ–º KZ-–ø–æ–ª—è –µ—Å–ª–∏ –æ–Ω–∏ —Å—É—â–µ—Å—Ç–≤—É—é—Ç
        if hasattr(instance, 'iin_verified'):
            data['iin_verified'] = instance.iin_verified
        
        return data
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ API —Ä–∞–±–æ—Ç–∞–µ—Ç **–î–û** –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π (–±–µ–∑ KZ-–ø–æ–ª–µ–π)
- ‚úÖ API —Ä–∞–±–æ—Ç–∞–µ—Ç **–ü–û–°–õ–ï** –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π (—Å KZ-–ø–æ–ª—è–º–∏)
- ‚úÖ –ù–µ—Ç downtime, –Ω–µ—Ç –æ—à–∏–±–æ–∫

---

## üìä –°–¢–ê–¢–£–° –§–ê–ô–õ–û–í

| –§–∞–π–ª | –°—Ç–∞—Ç—É—Å | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|--------|----------|
| `backend/apps/patients/serializers.py` | ‚úÖ FIXED | –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å |
| `backend/apps/visits/serializers.py` | ‚úÖ FIXED | –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å |
| `backend/apps/patients/views.py` | ‚úÖ FIXED | –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π prefetch |
| `backend/apps/patients/urls.py` | ‚è≥ PARTIAL | Endpoints –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã |
| `APPLY_MIGRATIONS.ps1` | ‚úÖ NEW | –°–∫—Ä–∏–ø—Ç –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–π |
| `FIX_500_NOW.md` | ‚úÖ NEW | –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è |
| `START_HERE.md` | ‚úÖ UPDATED | –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å—Å—ã–ª–∫–∞ –Ω–∞ fix |

---

## ‚ö° –ë–´–°–¢–†–ê–Ø –ü–†–û–í–ï–†–ö–ê

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

```bash
# 1. API –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤
curl http://localhost:8000/api/v1/patients/patients/

# 2. API –≤–∏–∑–∏—Ç–æ–≤
curl http://localhost:8000/api/v1/visits/visits/

# 3. API —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
curl http://localhost:8000/api/v1/staff/employees/
```

–í—Å–µ –¥–æ–ª–∂–Ω—ã –≤–µ—Ä–Ω—É—Ç—å `200 OK` —Å JSON –¥–∞–Ω–Ω—ã–º–∏.

---

## üéâ –ì–û–¢–û–í–û!

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —à–∞–≥–æ–≤ –≤—ã—à–µ:
- ‚úÖ –û—à–∏–±–∫–∞ 500 –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞
- ‚úÖ –°—Ç–∞—Ä—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ –ù–æ–≤—ã–µ KZ-—Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã
- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã
- ‚úÖ –ú–æ–∂–Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É

---

**–í—Ä–µ–º—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** ~2 –º–∏–Ω—É—Ç—ã  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** –ù–∏–∑–∫–∞—è  
**–†–∏—Å–∫–∏:** –ù–µ—Ç

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –°–º–æ—Ç—Ä–∏—Ç–µ `START_HERE.md` ‚Üí `README_KZ.md` ‚Üí `TODO_FRONTEND.md`

